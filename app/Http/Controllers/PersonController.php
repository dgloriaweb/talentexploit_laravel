<?php

namespace App\Http\Controllers;

use App\Person;
use Illuminate\Http\Request;

class PersonController extends Controller
{
    public function update_person(Request $request)
    {
        if (!session()->exists('person_id')) {
            return view('logged_out_home');
        }

        $person_id = session()->get('person_id');

        $array = [
            'workplace' => $request->input('workplace') == 'on' ? 1 : 0,
            'remote' => $request->input('remote') == 'on' ? 1 : 0,
            'workdays' => $request->input('workdays') == 'on' ? 1 : 0,
            'saturday' => $request->input('saturday') == 'on' ? 1 : 0,
            'sunday' => $request->input('sunday') == 'on' ? 1 : 0,
            'bank_holidays' => $request->input('bank_holidays') == 'on' ? 1 : 0,
            'sat_sun_bh_only' => $request->input('sat_sun_bh_only') == 'on' ? 1 : 0,
            'normal_hours' => $request->input('normal_hours') == 'on' ? 1 : 0,
            'nightshift' => $request->input('nightshift') == 'on' ? 1 : 0,
            'nightshift_only' => $request->input('nightshift_only') == 'on' ? 1 : 0,
            'other_shift' => $request->input('other_shift') == 'on' ? 1 : 0,
            'other_shift_only' => $request->input('other_shift_only') == 'on' ? 1 : 0,
            'overtime' => $request->input('overtime') == 'on' ? 1 : 0,
        ];

        if (Person::storeWorkPrefChanges($person_id, $array)) {
            return redirect('job_insight/'.$person_id)->with('success', 'Data updated!');
        } else {
            return redirect('job_insight/'.$person_id)->with('error', 'Something went wrong when updating work preferences. Data wasn\'t saved')
                ->withInput();
        }
    }
}
